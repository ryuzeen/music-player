<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video & Music Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700;900&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
        }
        /* Animação do fundo gradiente */
        .animated-gradient {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Efeito de texto com gradiente animado */
        .animated-text {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            animation: gradient 15s ease infinite;
        }

        /* Efeito de vidro fosco */
        .backdrop-blur-md {
             backdrop-filter: blur(12px);
             -webkit-backdrop-filter: blur(12px);
        }

        /* Animação das bolhas no fundo */
        .bubbles {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            overflow: hidden; z-index: 0;
        }
        .bubble {
            position: absolute; bottom: -150px; width: 40px; height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%; animation: floatUp 25s infinite linear;
        }
        .bubble:nth-child(1) { left: 10%; animation-duration: 20s; }
        .bubble:nth-child(2) { left: 20%; animation-duration: 15s; animation-delay: 2s; width: 20px; height: 20px; }
        .bubble:nth-child(3) { left: 25%; animation-duration: 30s; animation-delay: 4s; }
        .bubble:nth-child(4) { left: 40%; animation-duration: 22s; width: 60px; height: 60px; }
        .bubble:nth-child(5) { left: 70%; animation-duration: 18s; animation-delay: 1s; }
        .bubble:nth-child(6) { left: 80%; animation-duration: 28s; animation-delay: 3s; width: 30px; height: 30px; }
        .bubble:nth-child(7) { left: 90%; animation-duration: 17s; }
        .bubble:nth-child(8) { left: 55%; animation-duration: 23s; animation-delay: 5s; width: 25px; height: 25px; }
        .bubble:nth-child(9) { left: 35%; animation-duration: 19s; }
        .bubble:nth-child(10) { left: 50%; animation-duration: 26s; animation-delay: 2s; width: 50px; height: 50px; }

        @keyframes floatUp { to { transform: translateY(-105vh); opacity: 0; } }

        /* Efeito de borda neon */
        .neon-border-wrapper { position: relative; }
        .neon-border-wrapper::before {
            content: ''; position: absolute; top: -5px; left: -5px; right: -5px; bottom: -5px;
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%; z-index: -1; filter: blur(15px);
            animation: gradient 15s ease infinite, pulse-glow 4s ease-in-out infinite;
        }
        @keyframes pulse-glow { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
        
        /* Estilos da Playlist */
        .playlist-item.playing {
            background-color: rgba(139, 92, 246, 0.3);
            border-left-color: #a78bfa;
        }
    </style>
</head>
<body class="bg-gray-900 text-white overflow-hidden">

    <!-- Página de Entrada -->
    <div id="landing-page" class="h-screen w-screen flex flex-col items-center justify-center relative transition-opacity duration-1000">
        <div class="animated-gradient absolute inset-0 z-0"></div>
        <div class="bubbles">
            <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
            <div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div><div class="bubble"></div>
        </div>
        <div class="z-10 flex flex-col items-center justify-center text-center max-w-2xl w-full p-4">
            <div class="animated-gradient p-[3px] shadow-2xl neon-border-wrapper">
                <div class="bg-black/25 backdrop-blur-md p-8 md:p-10 w-full">
                    <h1 class="text-5xl md:text-7xl font-black uppercase tracking-wider mb-4 animated-text">Video & Music Player</h1>
                    <p class="text-lg md:text-xl font-light mb-8">Sua experiência offline a partir de vídeos do YouTube.</p>
                    <div class="bg-white/20 backdrop-blur-md p-6 rounded-2xl shadow-lg border border-white/30 mb-4 w-full">
                        <div class="flex items-center justify-center md:justify-start space-x-4">
                            <img src="https://avatars3.githubusercontent.com/u/8361145?s=200&v=4" alt="Ícone do AdGuard" class="w-16 h-16 rounded-lg">
                            <div class="text-left">
                                <h2 class="text-xl font-bold">Primeiro, baixe o AdGuard!</h2>
                                <p class="text-sm">Para uma experiência sem anúncios, clique abaixo para instalar a extensão.</p>
                            </div>
                        </div>
                         <a href="https://chromewebstore.google.com/detail/adguard-adblocker/bgnkhhnnamicmpeenaelnjfhikgbkllg?pli=1" id="adguard-link" class="mt-4 inline-block bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full transition-transform transform hover:scale-105 w-full">
                            Baixar AdGuard e Continuar
                        </a>
                    </div>
                    <button id="skip-to-player-link" class="text-white/80 hover:text-white underline transition">Pular para o player</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação AdGuard -->
    <div id="adguard-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-gray-800/80 backdrop-blur-md rounded-2xl p-8 text-center max-w-sm shadow-lg border border-white/20">
            <h3 class="text-xl font-bold mb-4">Você instalou o AdGuard?</h3>
            <p class="text-gray-300 mb-6">Se pular esta etapa, sua experiência poderá ser interrompida por propagandas.</p>
            <div class="flex flex-col gap-3">
                <button id="confirm-install-button" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full w-full">Sim, instalei e quero continuar!</button>
                <button id="skip-button" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full w-full">Pular mesmo assim</button>
            </div>
        </div>
    </div>

    <!-- Modal de Compartilhamento -->
    <div id="share-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-gray-800/80 backdrop-blur-md rounded-2xl p-8 text-center max-w-md w-full shadow-lg border border-white/20">
            <h3 class="text-xl font-bold mb-4">Compartilhar Playlist</h3>
            <p class="text-gray-300 mb-4">Copie o código abaixo e envie para um amigo.</p>
            <textarea id="share-code" readonly class="w-full bg-gray-900 p-2 rounded-md h-24 resize-none text-sm"></textarea>
            <div class="flex gap-3 mt-4">
                <button id="copy-code-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full w-full">Copiar Código</button>
                <button id="close-share-modal" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full w-full">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Player Page -->
    <div id="player-page" class="h-screen w-screen flex flex-col items-center justify-center bg-gray-900 p-4 transition-opacity duration-1000 opacity-0 hidden">
        <div class="w-full max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold text-center mb-6">Video & Music Player</h2>
            <div class="flex flex-col sm:flex-row gap-2 mb-6">
                <input type="text" id="youtube-link" placeholder="Cole o link do vídeo do YouTube aqui" class="flex-grow bg-gray-800 border-2 border-gray-700 focus:border-purple-500 focus:ring-purple-500 rounded-lg p-3 text-white transition">
                <button id="add-button" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105">Adicionar</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="md:col-span-2">
                    <div id="player-container" class="w-full aspect-video bg-black rounded-lg shadow-2xl overflow-hidden mb-4"></div>
                    <div class="flex justify-center gap-4">
                        <button id="prev-button" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-5 rounded-lg transition">Anterior</button>
                        <button id="next-button" class="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-5 rounded-lg transition">Próximo</button>
                    </div>
                </div>
                <div class="md:col-span-1 bg-gray-800/50 p-4 rounded-lg flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-lg">Playlist</h3>
                        <button id="share-playlist-button" class="bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-1 px-3 rounded-full">Compartilhar</button>
                    </div>
                    <ul id="playlist-ui" class="space-y-2 flex-grow overflow-y-auto h-72"></ul>
                    <div class="mt-4 pt-4 border-t border-gray-700">
                        <h4 class="font-semibold text-sm mb-2">Carregar Playlist</h4>
                        <div class="flex gap-2">
                            <input type="text" id="import-code-input" placeholder="Cole o código aqui" class="flex-grow bg-gray-900 border border-gray-600 rounded-md p-1 text-sm">
                            <button id="load-playlist-button" class="bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-3 rounded-md">Carregar</button>
                        </div>
                    </div>
                </div>
            </div>
            <p id="error-message" class="text-red-500 text-center mt-4 hidden">Link inválido. Por favor, insira um link válido do YouTube.</p>
        </div>
    </div>

    <script>
        // --- Variáveis Globais ---
        const landingPage = document.getElementById('landing-page');
        const playerPage = document.getElementById('player-page');
        const adguardLink = document.getElementById('adguard-link');
        const skipToPlayerLink = document.getElementById('skip-to-player-link');
        
        // --- Variáveis dos Modais ---
        const adguardModal = document.getElementById('adguard-modal');
        const confirmInstallButton = document.getElementById('confirm-install-button');
        const skipButton = document.getElementById('skip-button');
        const shareModal = document.getElementById('share-modal');
        const shareCodeText = document.getElementById('share-code');
        const copyCodeButton = document.getElementById('copy-code-button');
        const closeShareModalButton = document.getElementById('close-share-modal');

        // --- Variáveis do Player ---
        const addButton = document.getElementById('add-button');
        const prevButton = document.getElementById('prev-button');
        const nextButton = document.getElementById('next-button');
        const youtubeLinkInput = document.getElementById('youtube-link');
        const playerContainer = document.getElementById('player-container');
        const playlistUI = document.getElementById('playlist-ui');
        const errorMessage = document.getElementById('error-message');
        const sharePlaylistButton = document.getElementById('share-playlist-button');
        const importCodeInput = document.getElementById('import-code-input');
        const loadPlaylistButton = document.getElementById('load-playlist-button');
        
        let player;
        let playlist = [];
        let currentVideoIndex = -1;

        // --- Funções de Persistência (Salvar/Carregar) ---
        function savePlaylistToStorage() {
            try { localStorage.setItem('youtubePlaylist', JSON.stringify(playlist)); } 
            catch (e) { console.error("Não foi possível salvar a playlist.", e); }
        }
        function loadPlaylistFromStorage() {
            try {
                const savedPlaylist = localStorage.getItem('youtubePlaylist');
                if (savedPlaylist) playlist = JSON.parse(savedPlaylist);
            } catch (e) { console.error("Não foi possível carregar a playlist.", e); playlist = []; }
        }

        // --- Lógica de Transição de Página e Modais ---
        function showModal(modal) {
            modal.classList.remove('hidden');
            setTimeout(() => modal.classList.remove('opacity-0'), 10);
        }
        function closeModal(modal) {
            modal.classList.add('opacity-0');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }
        function goToPlayerPage() {
            closeModal(adguardModal);
            landingPage.classList.add('opacity-0');
            setTimeout(() => {
                landingPage.classList.add('hidden');
                playerPage.classList.remove('hidden');
                setTimeout(() => playerPage.classList.remove('opacity-0'), 50);
            }, 1000);
        }
        adguardLink.addEventListener('click', (e) => { e.preventDefault(); window.open(adguardLink.href, '_blank'); showModal(adguardModal); });
        skipToPlayerLink.addEventListener('click', () => showModal(adguardModal));
        confirmInstallButton.addEventListener('click', goToPlayerPage);
        skipButton.addEventListener('click', goToPlayerPage);
        adguardModal.addEventListener('click', (e) => { if (e.target === adguardModal) closeModal(adguardModal); });
        closeShareModalButton.addEventListener('click', () => closeModal(shareModal));
        shareModal.addEventListener('click', (e) => { if (e.target === shareModal) closeModal(shareModal); });


        // --- Lógica do Player do YouTube ---
        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        const firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player(playerContainer, {
                height: '100%', width: '100%',
                playerVars: { 'playsinline': 1, 'controls': 1 },
                events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange }
            });
        }
        function onPlayerReady(event) {
            if (playlist.length > 0) {
                currentVideoIndex = 0;
                player.cueVideoById(playlist[currentVideoIndex].id);
                renderPlaylist();
            }
        }
        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING && currentVideoIndex > -1 && playlist[currentVideoIndex] && !playlist[currentVideoIndex].title) {
                playlist[currentVideoIndex].title = player.getVideoData().title;
                savePlaylistToStorage();
                renderPlaylist();
            }
            if (event.data == YT.PlayerState.ENDED) playNext();
        }
        function getYouTubeVideoId(url) {
            const regex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            return url.match(regex) ? url.match(regex)[1] : null;
        }
        function renderPlaylist() {
            playlistUI.innerHTML = playlist.length === 0 ? '<li class="text-gray-500">Sua playlist está vazia.</li>' : '';
            playlist.forEach((video, index) => {
                const li = document.createElement('li');
                li.className = `playlist-item flex justify-between items-center p-2 rounded-md cursor-pointer border-l-4 border-transparent hover:bg-purple-500/20 transition-all duration-200 ${index === currentVideoIndex ? 'playing' : ''}`;
                li.dataset.index = index;
                const titleText = video.title ? video.title : `Vídeo adicionado`;
                li.innerHTML = `<span class="truncate pr-2">Vídeo ${index + 1}: ${titleText}</span><button class="ml-2 text-gray-400 hover:text-white flex-shrink-0">✕</button>`;
                li.querySelector('button').onclick = (e) => { e.stopPropagation(); removeSong(index); };
                li.onclick = () => playSong(index);
                playlistUI.appendChild(li);
            });
        }
        function playSong(index) {
            if (index >= 0 && index < playlist.length) {
                currentVideoIndex = index;
                player.loadVideoById(playlist[currentVideoIndex].id);
                renderPlaylist();
            }
        }
        function playNext() { if (playlist.length > 0) playSong((currentVideoIndex + 1) % playlist.length); }
        function playPrev() { if (playlist.length > 0) playSong((currentVideoIndex - 1 + playlist.length) % playlist.length); }
        function removeSong(index) {
            playlist.splice(index, 1);
            savePlaylistToStorage();
            if (playlist.length === 0) {
                currentVideoIndex = -1;
                player.stopVideo(); player.loadVideoById('');
            } else if (index === currentVideoIndex) {
                currentVideoIndex = index % playlist.length;
                playSong(currentVideoIndex);
            } else if (index < currentVideoIndex) {
                currentVideoIndex--;
            }
            renderPlaylist();
        }
        addButton.addEventListener('click', () => {
            const videoId = getYouTubeVideoId(youtubeLinkInput.value);
            if (videoId) {
                errorMessage.classList.add('hidden');
                playlist.push({ id: videoId, title: null });
                savePlaylistToStorage();
                youtubeLinkInput.value = '';
                renderPlaylist();
                if (currentVideoIndex === -1) playSong(0);
            } else {
                errorMessage.classList.remove('hidden');
            }
        });
        nextButton.addEventListener('click', playNext);
        prevButton.addEventListener('click', playPrev);

        // --- Lógica de Compartilhamento ---
        sharePlaylistButton.addEventListener('click', () => {
            if (playlist.length === 0) {
                alert("Sua playlist está vazia. Adicione vídeos para compartilhar.");
                return;
            }
            const jsonString = JSON.stringify(playlist);
            const base64Code = btoa(jsonString); // Converte para Base64
            shareCodeText.value = base64Code;
            showModal(shareModal);
        });

        copyCodeButton.addEventListener('click', () => {
            shareCodeText.select();
            document.execCommand('copy');
            copyCodeButton.textContent = 'Copiado!';
            setTimeout(() => { copyCodeButton.textContent = 'Copiar Código'; }, 2000);
        });

        loadPlaylistButton.addEventListener('click', () => {
            const code = importCodeInput.value.trim();
            if (!code) return;

            try {
                const jsonString = atob(code); // Decodifica de Base64
                const newPlaylist = JSON.parse(jsonString);
                
                if (Array.isArray(newPlaylist)) {
                    playlist = newPlaylist;
                    savePlaylistToStorage();
                    renderPlaylist();
                    importCodeInput.value = '';
                    if (playlist.length > 0) {
                        playSong(0);
                    }
                } else {
                    throw new Error("Código inválido.");
                }
            } catch (error) {
                console.error("Erro ao carregar playlist:", error);
                alert("O código da playlist é inválido ou está corrompido.");
            }
        });

        // --- Inicialização ---
        loadPlaylistFromStorage();
        renderPlaylist();
    </script>
</body>
</html>
